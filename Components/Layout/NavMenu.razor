@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Identity
@using GymTracker.Data

@rendermode InteractiveServer
@inject SignInManager<ApplicationUser> SignInManager
@inject NavigationManager Nav
@inject AuthenticationStateProvider AuthStateProvider

<header class="topbar">

    <!-- LOGO vänster -->
    <div class="logo" @onclick="GoHome">
        GymTracker
    </div>

    <!-- HÖGER: logout + burger -->
    <div class="right">
        @if (isLoggedIn)
        {
            <button class="login-btn" @onclick="HandleLogout">Logout</button>
            <button class="burger" @onclick="ToggleMenu">
                @(menuOpen ? "✕" : "☰")
            </button>
        }
        else
        {
            <a class="login-btn" href="/Account/Login">Login</a>
        }
    </div>

</header>

@if (menuOpen && isLoggedIn)
{
    <div class="side-menu">

        <a href="/dashboard" @onclick="CloseMenu">Dashboard</a>
        <a href="/exercises" @onclick="CloseMenu">Exercises</a>

    </div>
}

@code {
    bool menuOpen = false;
    bool isLoggedIn = false;

    protected override async Task OnInitializedAsync()
    {
        var auth = await AuthStateProvider.GetAuthenticationStateAsync();
        isLoggedIn = auth.User.Identity?.IsAuthenticated ?? false;
    }

    void ToggleMenu() => menuOpen = !menuOpen;
    void CloseMenu() => menuOpen = false;

    void GoHome()
    {
        if (isLoggedIn)
            Nav.NavigateTo("/dashboard");
        else
            Nav.NavigateTo("/");
    }

    async Task HandleLogout()
    {
        await SignInManager.SignOutAsync();
        Nav.NavigateTo("/Account/Login", true);
    }
}